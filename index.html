---
title: Firefox OS workshop
layout: main
---

<p>
Dans ce workshop, vous allez créer une application à la <em>Instagram</em> permettant d'appliquer des filtres sur des photos, et de les partager.<br />
</p>

<h3>#00a - Premiers pas avec Firefox OS</h3>
<p>
<ol>
  <li>Installez le simulateur et amusez vous avec Firefox OS <em>(testez ce que vous voulez, prenez le temps de vous familiariser avec le système)</em></li>
  <li>Installez l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App">Firefox OS Boilerplate</a> et lancez-la</li>
  <li>Installez l'application <a href="https://github.com/buildingfirefoxos/Building-Blocks">Building Blocks</a> et essayez-la également</li>
</ol>

À la fin de cette étape, vous devriez avoir un bon aperçu de ce qui est possible de faire facilement avec Firefox OS. Vous savez également comment lancer le simulateur et installer une application<br />

<center><img src="images/step-00a.png" /></center>



<h3>#00b - Création du manifest</h3>

<p>
Nous allons maintenant créer une application.<br />
Récupérez le projet de base :

{% highlight bash %}
$ git clone git@github.com:Nilhcem/xebia-fxos-workshop.git
$ cd xebia-fxos-workshop
$ git checkout master
{% endhighlight %}
</p>

Les fichiers de ce projet (triés par importance) :<br />
<ul>
  <li>index.html : La page principale de l'application, que vous aurez à modifier</li>
  <li>js/app.js : L'endroit où vous devrez écrire votre code javascript</li>
  <li>css/app.css : L'endroit où vous devrez mettre des règles css (si besoin)</li>
  <li>img/ : Contient les icones de l'application. Mettez d'autres images dans ce répertoire, si besoin</li>
  <li>css/buildingblocks : La librairie css permettant de créer des éléments graphiques au look "natif" de la plateforme</li>
  <li>js/psxeffects*.js : Une librairie permettant d'appliquer des filtres sur une image</li>
</ul>

Le projet ne s'installe pas sur le simulateur car il manque le fichier <b>manifest.webapp</b>.<br /><br />
Votre but est le suivant :<br />

<ol>
  <li>Créez le fichier <a href="https://developer.mozilla.org/en-US/Apps/Developing/Manifest">manifest.webapp</a> en spécifiant :
    <ul>
      <li>Une version (1.0.0)</li>
      <li>Un nom d'application (Xebiagram)</li>
      <li>Une description (A firefoxOS photo app)</li>
      <li>Le fichier de lancement (/index.html)</li>
      <li>Les icones 60px et 128px (/img/icon-*.png)</li>
    </ul>
  </li>
  <li>Installez l'application sur le simulateur</li>
  <li>Testez la (cliquez sur les liens pour changer d'écran)</li>
  <li>Regardez le code source (index.html, css/app.css, et js/app.js) pour bien comprendre comment s'effectue le changement d'écran</li>
</ol>

N'oubliez pas de vous inspirer du code source des 2 applications que vous avez téléchargé dans l'étape #00a pour créer le fichier manifest.webapp.

<center><img src="images/step-00b.png" /></center>



<h3>#01 - Ajout d'un header (ActionBar)</h3>

<p>
Nous allons ajouter un header (la barre orangée en haut de l'écran) sur les 2 écrans.<br />
<ul>
  <li>Sur le premier écran, il y aura uniquement le nom de l'application.</li>
  <li>Sur le second écran, il y aura un bouton retour (qui doit fonctionner), un libellé ("Edit photo"), et deux boutons "Edit" et "Share" (pas besoin de logique métier pour l'instant).</li>
</ul>

N'hésitez pas à consulter <a href="http://buildingfirefoxos.com/building-blocks/headers.html">la documentation</a> pour savoir comment créer un header et pour choisir <a href="http://buildingfirefoxos.com/building-blocks/primary-actions.html">quelle icone</a> afficher.
</p>

<center>
  <img src="images/step-01a.png" />
  <img src="images/step-01b.png" />
</center>



<h3>#02 - Ajout d'une Web Activity (pick image)</h3>

<p>
Le but de cette étape est d'ajouter un bouton "Pick image" qui lancera une Web Activity permettant à l'utilisateur de sélectionner une image.<br />
Une fois l'image sélectionnée, l'application doit passer automatiquement à l'écran #2 et afficher l'image.<br />
Sur le premier écran, il y aura aussi un bouton "About" qui affichera une dialog (<a href="http://www.w3schools.com/jsref/met_win_alert.asp">un simple alert</a> contenant le texte : "Hands-on Firefox OS\nXKE 2013").<br /><br />

Vous devrez regarder le code source de l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefox OS Boilerplate</a> (ou <a href="https://hacks.mozilla.org/2013/01/introducing-web-activities/">la documentation officielle</a>) pour voir comment implémenter cette Web Activity.
</p>

<center>
  <img src="images/step-02a.png" />
  <img src="images/step-02b.png" />
  <img src="images/step-02c.png" />
  <img src="images/step-02d.png" />
</center>



<h3>#03 - Ajout d'effets visuels sur la photo</h3>

<p>
Dans le second écran de notre application, il faut maintenant afficher une <a href="http://buildingfirefoxos.com/building-blocks/action-menu.html">dialog de sélection</a> du filtre à appliquer sur la photo lorsque l'utilisateur cliquera sur le bouton "Edit" de l'ActionBar.<br />
L'utilisateur pourra choisir parmi les effets suivants :
<ul>
  <li>sepia</li>
  <li>blackwhite</li>
  <li>bluetone</li>
  <li>greentone</li>
  <li>solarize</li>
  <li>mosaic</li>
  <li>mirrorleft2right</li>
</ul>

Chaque action lancera une fonction qui appliquera un filtre sur une image.<br />
La librarie appliquant un filtre à besoin d'un élément <code>&lt;canvas&gt;</code>.
C'est cet élément qui contiendra l'image modifiée avec filtre.
Il faut donc rajouter un tag canvas dans le 2me écran de notre application, en plus de l'élément contenant l'image de base :

{% highlight html %}
<canvas id="canvas-image" class="hidden">Your browser does not support the HTML5 canvas tag.</canvas>
{% endhighlight %}
</p>

<p>
L'idée est la suivante : Le 2me écran de l'application contient une <code>&lt;img&gt;</code> et un <code>&lt;canvas&gt;</code>.<br />
L'<code>&lt;img&gt;</code> contient l'image originelle, et le <code>&lt;canvas&gt;</code> contient l'image modifiée par la librairie javascript.<br />
Au début, le <code>&lt;canvas&gt;</code> est invisible ; lorsqu'un filtre est sélectionnée il faut :
<ul>
  <li>Cacher la dialog de sélection de filtre</li>
  <li>Appeler une librarie JS pour faire du traitement sur l'image</li>
  <li>Cacher l'image originale</li>
  <li>Afficher le canvas qui a été modifié par la lib JS</li>
</ul>

La fonction Javascript permettant d'appliquer un filtre sur une image à la définition suivante :

{% highlight javascript %}
function performEffect(type, orig, canvas);
{% endhighlight %}
</p>

Voici un exemple d'appel (ou <code>type</code> est une chaine de caractère ('sepia', 'blackwhite' etc.), <code>#original-image</code> est l'id d'une <code>&lt;img&gt;</img></code>, et <code>#canvas-image</code> l'id d'un <code>&lt;canvas&gt;</code>):

<p>
{% highlight javascript %}
var orig = document.querySelector("#original-image");
var canvas = document.querySelector("#canvas-image");
performEffect(type, orig, canvas);
{% endhighlight %}
</p>

<center>
  <img src="images/step-03a.png" />
  <img src="images/step-03b.png" />
</center>



<h3>#04 - Partage de l'image modifiée</h3>

<p>
Il ne nous reste plus qu'à partager l'image modifiée.<br />
Pour cela, on va encore une fois utiliser une WebActivity, et nous inspirer, de nouveau, du code de partage d'image de <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefos OS Boilerplate</a>.
Pour tester que le tout fonctionne, essayez de partager l'image avec "Wallpaper" et cliquez sur "Set as wallpaper". Cliquez ensuite sur le bouton "Home" et admirez le résultat.
</p>

<center>
  <img src="images/step-04a.png" />
  <img src="images/step-04b.png" />
</center>

