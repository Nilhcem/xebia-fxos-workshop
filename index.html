---
title: Firefox OS workshop
layout: main
---

<p>
Durant cet atelier, vous allez <a href="http://www.slideshare.net/Nilhcem/fxos">découvrir</a> Firefox OS, et créer une application similaire à <em>Instagram</em> permettant d'appliquer des filtres sur des photos.<br />
</p>

<h3>#00a - Premiers pas avec Firefox OS</h3>
<p>
<ol>
  <li><a href="https://support.mozilla.org/en-US/kb/how-set-firefox-os-desktop-build">Installez</a> le simulateur et amusez vous avec Firefox OS <em>(testez ce que vous voulez, prenez le temps de vous familiariser avec le système)</em></li>
  <li><a href="https://hacks.mozilla.org/2013/03/how-to-install-packaged-apps-in-firefox-os-options-and-tools/">Installez</a> l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App">Firefox OS Boilerplate</a> et testez la</li>
  <li>Installez l'application <a href="https://github.com/buildingfirefoxos/Building-Blocks">Building Blocks</a> et essayez la également.</li>
</ol>

<center><img src="images/step-00a.png" /></center>



<h3>#00b - Création du manifest</h3>

<p>
Vous allez créer une application pour Firefox OS en partant d'un projet de base :

{% highlight bash %}
$ git clone git@github.com:Nilhcem/xebia-fxos-workshop.git
$ cd xebia-fxos-workshop
$ git checkout master
{% endhighlight %}
</p>

<p>
Ce projet contient plusieurs fichiers (triés ici par importance) :<br />
<ul>
  <li><code>index.html</code> La page principale de l'application, que vous aurez à modifier</li>
  <li><code>js/app.js</code> L'endroit où vous devrez écrire du code javascript</li>
  <li><code>css/app.css</code> L'endroit où vous devrez mettre de nouvelles règles css (si besoin)</li>
  <li><code>img/</code> Contient les icones de l'application.</li>
  <li><code>css/buildingblocks</code> La librairie css permettant de créer des éléments graphiques au look "natif" de la plateforme</li>
  <li><code>js/psxeffects*.js</code> Une librairie (<a href="https://github.com/zhijie/psx">sources</a>) simple d'utilisation permettant d'appliquer des filtres sur une image</li>
</ul>
</p>

<p>L'application que vous venez de récupérer ne s'installe pas sur le simulateur car il manque le fichier <code>manifest.webapp</code>.
Votre but est le suivant :<br />

<ol>
  <li>Créez le fichier <a href="https://developer.mozilla.org/en-US/Apps/Developing/Manifest">manifest.webapp</a> <em>(aidez vous du code source des deux applications que vous avez téléchargé précédemment)</em> en spécifiant un numéro de version, un nom d'application, une description, le fichier de lancement et l'emplacement des icones 60px et 128px</li>
  <li>Installez l'application sur le simulateur</li>
  <li>Testez la <em>(cliquez sur les liens pour changer d'écran et vérifiez que ça fonctionne)</em></li>
  <li>Lisez le code source (<code>index.html</code>, <code>css/app.css</code>, et <code>js/app.js</code>) pour bien comprendre comment s'effectue le changement d'écran</li>
</ol>

<center>
  <img src="images/step-00b.png" />
  <img src="images/step-00c.png" />
</center>



<h3>#01 - Ajout d'un header (ActionBar)</h3>

<p>
Vous allez maintenant rajouter un header <em>(la barre orangée en haut)</em> sur chaque écran.<br />
<ul>
  <li>Sur le premier écran, affichez le nom de l'application</li>
  <li>Sur le second écran, ajoutez un bouton retour <em>(et sa logique métier)</em>, un libellé ("Edit photo"), et deux boutons "Edit" et "Share" <em>(qui n'ont pas besoin de logique métier pour l'instant)</em>.</li>
</ul>

N'hésitez pas à consulter <a href="http://buildingfirefoxos.com/building-blocks/headers.html">la documentation</a> pour savoir comment créer un header et pour choisir <a href="http://buildingfirefoxos.com/building-blocks/primary-actions.html">quelle icone</a> afficher.
</p>

<center>
  <img src="images/step-01a.png" />
  <img src="images/step-01b.png" />
</center>


<h3>#02a - Ajout de boutons</h3>

Vous pouvez maintenant :
<ol>
  <li> Supprimer le contenu du premier écran (le lien tout moche "Go to page #2").</li>
  <li> Ajouter un <a href="http://buildingfirefoxos.com/building-blocks/buttons.html">bouton</a> "About" qui affichera une dialog (<a href="http://www.w3schools.com/jsref/met_win_alert.asp">un simple alert</a>) contenant le texte que vous pouvez voir sur le screenshot ci-dessous</li>
  <li> Ajouter un autre bouton "Choose an image" sans logique métier pour l'instant</li>
  <li> Décorer la page d'une image de fond, si vous le souhaitez (facultatif)</li>
</ol>

<center>
  <img src="images/step-02a.png" />
  <img src="images/step-02b.png" />
</center>


<h3>#02b - WebActivity : Sélection d'image</h3>

<p>
On va maintenant rajouter la logique métier au bouton "Choose an image".<br />
Lorsque l'utilisateur cliquera sur ce bouton, il faudra lancer une Web Activity de sélection d'image.<br />
Une fois l'image sélectionnée, l'application doit passer automatiquement à l'écran #2 et afficher l'image choisie.<br />

Vous devrez regarder le code source de l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefox OS Boilerplate</a> (ou <a href="https://hacks.mozilla.org/2013/01/introducing-web-activities/">la documentation officielle</a>) pour savoir comment implémenter cette Web Activity.
</p>

<center>
  <img src="images/step-02c.png" />
  <img src="images/step-02d.png" />
</center>


<h3>#03a - Une dialogue de sélection</h3>

Vous allez maintenant rajouter de la logique métier au bouton "Edit" situé dans la barre de header du second écran de votre application.<br />
Lorsque l'utilisateur cliquera sur ce bouton, une <a href="http://buildingfirefoxos.com/building-blocks/action-menu.html">dialogue de sélection</a> listant les effets disponibles pouvant être appliqués sur la photo doit apparaître.<br /><br />
L'utilisateur pourra choisir parmi les effets suivants :
<ul>
  <li>sepia</li>
  <li>blackwhite</li>
  <li>bluetone</li>
  <li>greentone</li>
  <li>solarize</li>
  <li>mosaic</li>
  <li>mirrorleft2right</li>
</ul>

Lorsque l'utilisateur cliquera sur un élément de cette liste, il faudra cacher cette liste et éxécuter du code Javascript pour appliquer un effet visuel à la photo.<br />
Contentez vous, dans cette étape, de cacher la liste quand un élément est sélectionné.<br />
Vous implémenterez la logique appliquant des effets visuels dans l'étape suivante.

<center>
  <img src="images/step-03a.png" />
</center>



<h3>#03b - Ajout d'effets visuels sur la photo sélectionnée</h3>

Afin d'appliquer des effets sur une photo, vous allez utiliser une librairie Javascript <em>(déjà importée dans le projet)</em>.<br />
Cette librairie a besoin de 2 éléments pour fonctionner :
<ul>
  <li>une <code>&lt;img&gt;</code> <em>(que vous avez déjà)</em> et qui est l'image source</li>
  <li>un <code>&lt;canvas&gt;</code> qui contiendra le résultat généré par la librairie.<br />La balise HTML5 <code>&lt;canvas&gt;</code> est utilisée pour dessiner des graphiques à la volée, sur une page web.</li>
</ul>


Commencez par rajouter un <code>&lt;canvas&gt;</code> dans le code html du second écran de votre application :
{% highlight html %}
<canvas id="canvas-image" class="hidden">Your browser does not support the HTML5 canvas tag.</canvas>
{% endhighlight %}<br />

Par défaut, le <code>&lt;canvas&gt;</code> est <code>"hidden"</code> pour n'afficher que l'image de base.<br />
Lorsque l'utilisateur sélectionnera un filtre, vous cacherez l'image et afficherez le canvas à la place.<br /><br />

La méthode Javascript permettant d'appliquer un filtre sur une image à la définition suivante :

{% highlight javascript %}
function performEffect(type, orig, canvas);
{% endhighlight %}
<ul>
  <li><code>type</code> : nom de l'effet, parmi ceux listés dans l'étape #03a <em>('sepia', 'blackwhite' etc.)</em></li>
  <li><code>orig</code> : l'élément <code>&lt;img&gt;</img></code> de votre page web contenant l'image de base</li>
  <li><code>canvas</code> l'élément <code>&lt;canvas&gt;</code> de votre page web qui contiendra l'image générée</li>
</ul>
</p>

Voici un exemple d'appel :
<p>
{% highlight javascript %}
var type = 'sepia';
var orig = document.querySelector("#original-image");
var canvas = document.querySelector("#canvas-image");
performEffect(type, orig, canvas);
{% endhighlight %}
</p>

<center>
  <img src="images/step-03b.png" />
  <img src="images/step-03c.png" />
</center>



<h3>#04 - Partage de l'image modifiée</h3>

<p>
Votre application permet maintenant d'appliquer un effet sur une image.<br />
La dernière étape consiste à pouvoir partager cette image.<br />
Pour cela, vous utiliserez une WebActivity (en s'inspirant encore une fois du code de partage d'image de <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefos OS Boilerplate</a>).<br />
Afin de tester que le partage fonctionne, partagez l'image avec le "Wallpaper" et cliquez sur "Set as wallpaper". Cliquez ensuite sur le bouton "Home" pour retourner sur l'écran d'accueil de Firefox OS, et admirez le résultat.
</p>

<center>
  <img src="images/step-04a.png" />
  <img src="images/step-04b.png" />
</center>



<h3>#05 - Peaufiner le tout</h3>

<p>
Il ne vous reste plus qu'à peaufiner votre application, et à apprendre plus sur le développement d'applications HTML5.<br />
Si vous avez un peu de temps, voici quelques suggestions de choses à ajouter/tester pour améliorer votre application :

<ul>
  <li>Du remote debugging (<a href="http://people.apache.org/~pmuellr/weinre/docs/latest/">lien</a>)</li>
  <li>Des animations CSS (<a href="http://buildingfirefoxos.com/transitions/app-invokes-app.html">lien</a>)</li>
  <li>De l'internationalisation (<a href="https://hacks.mozilla.org/2013/08/localizing-firefox-os-apps/">lien</a>)</li>
  <li>Des tests unitaires (<a href="http://qunitjs.com/">lien</a>)</li>
  <li>Des tests fonctionnels (<a href="https://blog.mozilla.org/webqa/2013/02/07/part1-firefoxos-and-marionette/">lien</a>)</li>
  <li>Des traitements en background (<a href="http://www.sitepoint.com/javascript-threading-html5-web-workers/">lien</a>)</li>
  <li>De la persistence (IndexedDB) (<a href="https://developer.mozilla.org/en-US/docs/IndexedDB/Using_IndexedDB">lien</a>)</li>
  <li>Du cache (appcache) (<a href="https://developer.mozilla.org/en/docs/HTML/Using_the_application_cache">lien</a>)</li>
  <li>Un bouton d'installation, si l'app est utilisée depuis le navigateur (<a href="https://github.com/wavysandbox/install">lien</a>, <a href="https://github.com/mozilla/mortar-app-stub/blob/master/js/app.js">lien</a>)</li>
  <li>Une compatibilité multi-résolutions avec les média queries (<a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Media_queries">lien</a>)</li>
  <li>Une compatibilité multi navigateurs</li>
  <li>Une publication sur le Marketplace</li>
  <li>En vrac : testez volo, grunt, require js, coffeescript, less, sass...</li>
</ul><br />

<p style="text-align: right;">
~Have fun~
</p>
