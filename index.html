---
title: Firefox OS workshop
layout: main
---

<p>
Durant ce workshop, vous allez <a href="http://www.slideshare.net/Nilhcem/fxos">découvrir</a> Firefox OS, et créer une application similaire à <em>Instagram</em> permettant d'appliquer des filtres sur des photos.<br />
</p>

<h3>#00a - Premiers pas avec Firefox OS</h3>
<p>
<ol>
  <li><a href="https://support.mozilla.org/en-US/kb/how-set-firefox-os-desktop-build">Installez</a> le simulateur et amusez vous avec Firefox OS <em>(testez ce que vous voulez, prenez le temps de vous familiariser avec le système)</em></li>
  <li><a href="https://hacks.mozilla.org/2013/03/how-to-install-packaged-apps-in-firefox-os-options-and-tools/">Installez</a> l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App">Firefox OS Boilerplate</a> et testez la</li>
  <li>Installez l'application <a href="https://github.com/buildingfirefoxos/Building-Blocks">Building Blocks</a> et essayez la également.</li>
</ol>

<center><img src="images/step-00a.png" /></center>



<h3>#00b - Création du manifest</h3>

<p>
Nous allons créer une application pour Firefox OS en partant d'un projet de base :

{% highlight bash %}
$ git clone git@github.com:Nilhcem/xebia-fxos-workshop.git
$ cd xebia-fxos-workshop
$ git checkout master
{% endhighlight %}
</p>

<p>
Ce projet contient plusieurs fichiers (triés ici par importance) :<br />
<ul>
  <li><code>index.html</code> La page principale de l'application, que vous aurez à modifier</li>
  <li><code>js/app.js</code> L'endroit où vous devrez écrire votre code javascript</li>
  <li><code>css/app.css</code> L'endroit où vous devrez mettre des règles css (si besoin)</li>
  <li><code>img/</code> Contient les icones de l'application. Peut également contenir d'autre images, si vous le souhaitez</li>
  <li><code>css/buildingblocks</code> La librairie css permettant de créer des éléments graphiques au look "natif" de la plateforme</li>
  <li><code>js/psxeffects*.js</code> Une librairie (<a href="https://github.com/zhijie/psx">sources</a>) simple d'utilisation permettant d'appliquer des filtres sur une image</li>
</ul>
</p>

<p>L'application que vous venez de récupérer ne s'installe pas sur le simulateur car il manque le fichier <code>manifest.webapp</code>.
Votre but est le suivant :<br />

<ol>
  <li>Créez le fichier <a href="https://developer.mozilla.org/en-US/Apps/Developing/Manifest">manifest.webapp</a> <em>(aidez vous du code source des deux applications que vous avez téléchargé précédemment)</em> en spécifiant un numéro de version, un nom d'application, une description, le fichier de lancement et l'emplacement des icones 60px et 128px</li>
  <li>Installez l'application sur le simulateur</li>
  <li>Testez la <em>(cliquez sur les liens pour changer d'écran et vérifiez que ça fonctionne)</em></li>
  <li>Lisez le code source (<code>index.html</code>, <code>css/app.css</code>, et <code>js/app.js</code>) pour bien comprendre comment s'effectue le changement d'écran</li>
</ol>

<center><img src="images/step-00b.png" /></center>



<h3>#01 - Ajout d'un header (ActionBar)</h3>

<p>
Nous allons maintenant rajouter un header <em>(la barre orangée en haut)</em> sur chaque écran.<br />
<ul>
  <li>Sur le premier écran, affichez le nom de l'application</li>
  <li>Sur le second écran, ajoutez un bouton retour <em>(et sa logique métier)</em>, un libellé ("Edit photo"), et deux boutons "Edit" et "Share" <em>(qui n'ont pas besoin de logique métier pour l'instant)</em>.</li>
</ul>

N'hésitez pas à consulter <a href="http://buildingfirefoxos.com/building-blocks/headers.html">la documentation</a> pour savoir comment créer un header et pour choisir <a href="http://buildingfirefoxos.com/building-blocks/primary-actions.html">quelle icone</a> afficher.
</p>

<center>
  <img src="images/step-01a.png" />
  <img src="images/step-01b.png" />
</center>


<h3>#02a - Ajout de boutons</h3>

Vous pouvez maintenant :
<ol>
  <li> Supprimer le contenu du premier écran (le lien tout moche "Go to page #2").</li>
  <li> Ajouter un <a href="http://buildingfirefoxos.com/building-blocks/buttons.html">bouton</a> "About" qui affichera une dialog (<a href="http://www.w3schools.com/jsref/met_win_alert.asp">un simple alert</a>) contenant le texte que vous pouvez voir sur le screenshot ci-dessous</li>
  <li> Ajouter un autre bouton "Choose an image" sans logique métier pour l'instant</li>
  <li> Décorer la page d'une image de fond, si vous le souhaitez (facultatif)</li>
</ol>

<center>
  <img src="images/step-02a.png" />
  <img src="images/step-02b.png" />
</center>


<h3>#02b - WebActivity : Sélection d'image</h3>

<p>
On va maintenant rajouter la logique métier au bouton "Choose an image".<br />
Lorsque l'utilisateur cliquera sur ce bouton, il faudra lancer une Web Activity de sélection d'image.<br />
Une fois l'image sélectionnée, l'application doit passer automatiquement à l'écran #2 et afficher l'image choisie.<br />

Vous devrez regarder le code source de l'application <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefox OS Boilerplate</a> (ou <a href="https://hacks.mozilla.org/2013/01/introducing-web-activities/">la documentation officielle</a>) pour voir comment implémenter cette Web Activity.
</p>

<center>
  <img src="images/step-02c.png" />
  <img src="images/step-02d.png" />
</center>



<h3>#03 - Ajout d'effets visuels sur la photo sélectionnée</h3>

Lorsque l'utilisateur clique sur le bouton "Edit" dans le second écran de votre application, une <a href="http://buildingfirefoxos.com/building-blocks/action-menu.html">dialog de sélection</a> listant les filtres disponibles qui peuvent être appliqués sur la photo doit apparaître.<br /><br />
L'utilisateur pourra choisir parmi les effets suivants :
<ul>
  <li>sepia</li>
  <li>blackwhite</li>
  <li>bluetone</li>
  <li>greentone</li>
  <li>solarize</li>
  <li>mosaic</li>
  <li>mirrorleft2right</li>
</ul>

Chaque action lancera une fonction qui appliquera un filtre sur une image.<br /><br />

La librarie permettant d'appliquer un filtre sur une image à besoin d'un élément <code>&lt;canvas&gt;</code>.
C'est cet élément qui contiendra l'image modifiée avec le filtre sélectionné.
Il faut donc rajouter un tag <code>&lt;canvas&gt;</code> dans le second écran de votre application, en plus de l'élément contenant l'image de base :

{% highlight html %}
<canvas id="canvas-image" class="hidden">Your browser does not support the HTML5 canvas tag.</canvas>
{% endhighlight %}
</p><br />

<p>
L'idée est la suivante : Le second écran de l'application contient une <code>&lt;img&gt;</code> et un <code>&lt;canvas&gt;</code>.<br />
L'<code>&lt;img&gt;</code> contient l'image originelle, et le <code>&lt;canvas&gt;</code> contient l'image modifiée par la librairie javascript.<br />
Au début, le <code>&lt;canvas&gt;</code> est invisible ; lorsqu'un filtre est sélectionnée il faut :
<ul>
  <li>Cacher la dialog de sélection de filtre</li>
  <li>Appeler une librarie JS pour faire du traitement sur l'image</li>
  <li>Cacher l'image originale</li>
  <li>Afficher le canvas qui a été modifié par la lib JS</li>
</ul>

La fonction Javascript permettant d'appliquer un filtre sur une image à la définition suivante :

{% highlight javascript %}
function performEffect(type, orig, canvas);
{% endhighlight %}
</p>

Voici un exemple d'appel (ou <code>type</code> est une chaine de caractère ('sepia', 'blackwhite' etc.), <code>#original-image</code> est l'id d'une <code>&lt;img&gt;</img></code>, et <code>#canvas-image</code> l'id d'un <code>&lt;canvas&gt;</code>):

<p>
{% highlight javascript %}
var orig = document.querySelector("#original-image");
var canvas = document.querySelector("#canvas-image");
performEffect(type, orig, canvas);
{% endhighlight %}
</p>

<center>
  <img src="images/step-03a.png" />
  <img src="images/step-03b.png" />
</center>

<p>À vos claviers (et bon courage ! C'est l'étape qui prend le plus de temps, mais c'est aussi celle qui apporte le plus de valeur métier à votre application, non ?)</p>


<h3>#04 - Partage de l'image modifiée</h3>

<p>
Maintenant que l'image peut être modifiée, il ne nous reste plus qu'à ajouter l'option pour pouvoir partager cette image modifiée.<br />
Pour cela, on va utiliser une WebActivity (en s'inspirant encore une fois du code de partage d'image de <a href="https://github.com/robnyman/Firefox-OS-Boilerplate-App/blob/gh-pages/js/webapp.js">Firefos OS Boilerplate</a>).<br />
Pour tester que le tout fonctionne, essayez de partager l'image avec "Wallpaper" et cliquez sur "Set as wallpaper". Cliquez ensuite sur le bouton "Home" et admirez le résultat.
</p>

<center>
  <img src="images/step-04a.png" />
  <img src="images/step-04b.png" />
</center>



<h3>#05 - Peaufiner le tout</h3>

<p>
Félicitations, vous êtes arrivé à la fin de ce hands-on.<br />
Vous pouvez maintenant finaliser votre application en ajoutant ce que vous voulez !<br />
Voici quelques suggestions :

<ul>
  <li>Des animations css (<a href="http://buildingfirefoxos.com/transitions/app-invokes-app.html">lien</a>)</li>
  <li>De l'internationalisation (<a href="https://hacks.mozilla.org/2013/08/localizing-firefox-os-apps/">lien</a>)</li>
  <li>Des tests fonctionnels (<a href="https://blog.mozilla.org/webqa/2013/02/07/part1-firefoxos-and-marionette/">lien</a>)</li>
  <li>Du cache (<a href="https://developer.mozilla.org/en-US/docs/IndexedDB/Using_IndexedDB">lien</a>)</li>
  <li>Des traitements en background (<a href="http://www.sitepoint.com/javascript-threading-html5-web-workers/">lien</a>)</li>
  <li>Une meilleure librairie JS de traitement d'images, compatible avec les traitements en background</li>
  <li>Un bouton d'installation si l'app est utilisée depuis le navigateur (<a href="https://github.com/wavysandbox/install">lien</a>)</li>
  <li>Une compatibilité multi browser</li>
  <li>Locker en portrait-only (arrrrgh)</li>
  <li>Des trucs cools : volo, require js, yeoman, coffeescript, less...</li>
  <li>Une publication sur le Marketplace</li>
</ul>
